!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("sockjs-client"),require("@stomp/stompjs"),require("@hatiolab/things-scene")):"function"==typeof define&&define.amd?define(["exports","sockjs-client","@stomp/stompjs","@hatiolab/things-scene"],t):t((e=e||self)["things-scene-stomp"]={},e.SockJS,e.StompCli,e.scene)}(this,function(e,t,s,o){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,s=s&&s.hasOwnProperty("default")?s.default:s;const i={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"url",name:"url",property:"url",placeholder:"http://127.0.0.1:15674/stomp"},{type:"string",label:"subject",name:"subject",property:"subject"},{type:"string",label:"login",name:"login",property:"login"},{type:"string",label:"passcode",name:"passcode",property:"passcode"},{type:"select",label:"data-format",name:"dataFormat",property:{options:[{display:"Plain Text",value:"text"},{display:"JSON",value:"json"}]}},{type:"checkbox",label:"debug",name:"debug",property:"debug"}]},n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABOCAMAAADcmSJQAAAAUVBMVEVHcEwzMzNmZmbMzMwAAAA0AAA0ADSZmZn///8zNAAAHzMANABnAABnMzJnMWdnMwCaZJpmZzAxZkxnADOaZmVkmmTL/8rNmM0zMmf/zMuXzM2XfcQdAAAAAXRSTlMAQObYZgAAA5RJREFUeF7tmdl22zoMRXMOAFIek7S94/9/aFWRXFBM0zbV0KsP2XRe5NhbGATJ0kvhiy8kYobyXOtEaIbTE4OlrqA8V+tAnlRahTrPiVmW0gKXZkyfqVgc6e8CQEeZqbdAbeYzvBoAHWOGam/IGj9DrHcwFzsRqogjxR5yDQaL9ZoY5BPEtZkyYRZHAlE2itFvBhmZCq3bax211wyeiTxwyO1N3isG35k/9CvLE1QH5Lo2787kGTqDxStx6ymL2mUmeT6k2vo1AuM0SOxmEldbjjJGbMUDNXXwA6qIwJIC2V7jNuHq0JYpnTQkJvUAsQIIF1sik88vkzhAnGPG5RyBlvoKVDuyrQ8DD9rniC6RIvXaCHExu3dGZ1gOqt4id2hztlN6zzyVCxJJG6Wrq6f0lY9oy1EFqAZ6nNTEppME8djg2vvxvIbCbeJ6FLU2A/X/4cf//3VfkaDZPqq1A7iyFWSE6j/94sdnyLUhBsY3+uzoEZMPWUPzuNpt+DmnM7zb2PgWGiUB+f5v6q8N4mZvNd+wouaZsLIPUuQikYBihtIWR3fANZi5P0D57odXA3CqvaIzolsIBwC297TcIH6euLQ3zBu+x8xFDN0IFsJhfgW9Ca+KqZtBotp8/ustigjZiBk6M1F/hyXmxltvf5ezJqQhHgUkV5KjxNAGFF2Q6jJAYv8PxpqgTVJgrCOW/g6qOeg9pipi0TscAgrozbQTuyJ2wg6O7TtqUZALsUzq9ATv6EPgYoDESbaM6oCAQ4A+av1QZdFknqIOBvhQZeats1o4VIsPuZb1W1EiMUyb8IBH41rDqq+hCh2KlWjtZKsiM+9QGBasa3FcjU2UTs9DwcZocVxWJS7sbY9EOHyKNSXyZGnZSqwzR6hpBRQFxe/k2Io3DUkXW86DmbWHFHr2Atmavrws0xSwi09l4Zh3zcxz0MxEqcm8tFzpBUVlzcsfpKwjPlm1UhZgN3bC9r4bju0rbU6zUl6qiNsrvOblmbhJHSzMqisQb/VqpcTvTM0Mtguv33ffd2U3dmbQxm7kdlp5/cbMWnwMrzdWI6Acki+z/PJNbl2nuerq64neaZM7FcpWazwMLRVpfVzbtCpUmlIdxBt3QEyv2c1PoSISI8nTN8DHoA+BfavzKLceEDuWXwVsfJDRvoXu7jbbxVDw7g3sSQi0L4ZrBK1RScYo8tKHSCRBZLh8Sft/l9fM9PLH8sVPxYRe1ylX8kMAAAAASUVORK5CYII=";class a extends(o.DataSource(o.RectPath(o.Shape))){static get image(){return a._image||(a._image=new Image,a._image.src=n),a._image}added(){this.app.isViewMode&&this._initStomp()}_initStomp(){var{url:e,debug:o=!1,subject:i,login:n,passcode:a,dataFormat:c="text"}=this.model,r=new t(e);this._client=s.over(r),o||(this._client.debug=(()=>{})),this._client.connect(n,a,()=>{console.info("Stomp connected!"),this._client.subscribe(i,e=>{this.data=this._convertDataFormat(e.body,c)})},()=>{console.info("Stomp connect failed!")},"/")}dispose(){try{this._client&&this._client.connected&&this._client.disconnect(()=>console.info("stomp subscrition disconnected"))}catch(e){console.error(e)}delete this._client,super.dispose()}disconnect(){}_draw(e){var{left:t,top:s,width:o,height:i}=this.bounds;e.beginPath(),e.drawImage(a.image,t,s,o,i)}get nature(){return i}}o.Component.register("stomp",a),e.Stomp=a,Object.defineProperty(e,"__esModule",{value:!0})});
